<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Amigo de Mierda 🎉 - Juego Móvil</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <!-- Fuente divertida -->
  <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet" />
  <style>
    /* Reset y estilo base mobile-first */
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    body {
      min-height: 100vh;
      background: linear-gradient(135deg, #f9f1ff 0%, #ffd2f0 100%);
      font-family: 'Fredoka One', cursive, Arial, sans-serif;
      color: #333;
      padding: 16px 12px 70px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
    }
    .container {
      max-width: 430px;
      width: 100%;
      background: #fff;
      border-radius: 24px;
      box-shadow: 0 5px 25px rgb(255 49 105 / 0.2);
      padding: 24px 20px 36px;
      display: flex;
      flex-direction: column;
      gap: 18px;
    }
    h1 {
      font-size: 2rem;
      text-align: center;
      color: #ff3169;
      text-shadow: 1px 1px 3px #ffbfd1cc;
      user-select: none;
    }
    /* --- Sección agregar jugadores --- */
    #setup-section {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }
    .name-input-group {
      display: flex;
      gap: 10px;
    }
    .name-input-group input {
      flex-grow: 1;
      font-size: 1.1rem;
      padding: 0.74em 1em;
      border-radius: 12px;
      border: 2px solid #ffb2de;
      outline-offset: 2px;
      outline-color: #ff3169aa;
      transition: border-color 0.3s;
    }
    .name-input-group input:focus {
      border-color: #ff3169;
    }
    .name-input-group button {
      background-color: #4bf542;
      border: none;
      border-radius: 12px;
      padding: 0 16px;
      font-weight: 700;
      color: #1c2f11;
      cursor: pointer;
      font-size: 1.1rem;
      transition: background-color 0.3s;
    }
    .name-input-group button:disabled {
      background-color: #b4ecb4;
      cursor: default;
      color: #568f56;
    }
    .name-input-group button:hover:not(:disabled) {
      background-color: #10bb10;
      color: white;
    }
    #player-list {
      list-style: none;
      background-color: #ffd6f1;
      border-radius: 12px;
      padding: 8px 12px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      min-height: 38px;
      font-size: 1.1rem;
      color: #20401f;
      user-select: none;
    }
    #player-list li {
      background-color: #4bf542cc;
      padding: 6px 12px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      min-width: 70px;
    }
    #player-list li button.remove-player {
      font-weight: 700;
      font-size: 1.3rem;
      color: #ff3169dd;
      background: none;
      border: none;
      padding: 0;
      cursor: pointer;
      line-height: 1;
      user-select: none;
      transition: color 0.25s;
    }
    #player-list li button.remove-player:hover {
      color: #ff004fdd;
    }
    #start-btn {
      background-color: #ff3169;
      border: none;
      border-radius: 16px;
      padding: 14px 0;
      color: white;
      font-size: 1.25rem;
      font-weight: 800;
      cursor: pointer;
      transition: background-color 0.3s;
      user-select: none;
    }
    #start-btn:disabled {
      background-color: #ff99b9;
      cursor: not-allowed;
    }
    #start-btn:hover:not(:disabled) {
      background-color: #ff0056;
    }
    /* --- Juego principal --- */
    #game-section {
      display: none;
      flex-direction: column;
      gap: 20px;
    }
    .scoreboard {
      display: flex;
      justify-content: space-around;
      background-color: #fff0f2;
      border-radius: 15px;
      padding: 12px 0;
      box-shadow: 0 3px 10px #ff31696e;
      user-select: none;
    }
    .score-player {
      display: flex;
      flex-direction: column;
      align-items: center;
      min-width: 60px;
      font-weight: 700;
      font-size: 1.1rem;
      color: #4a4a4a;
      position: relative;
    }
    .score-player.current::after {
      content: "▶";
      position: absolute;
      top: 0;
      right: -20px;
      font-size: 1.4rem;
      color: #ff3169;
      user-select: none;
      animation: pulseArrow 1s ease-in-out infinite;
    }
    @keyframes pulseArrow {
      0%, 100% { opacity: 1; transform: translateX(0);}
      50% { opacity: 0.4; transform: translateX(4px);}
    }
    .score-player span.points {
      margin-top: 6px;
      color: #ff3169;
      font-size: 1.3rem;
    }
    #turn-indicator {
      text-align: center;
      font-weight: 700;
      font-size: 1.3rem;
      color: #a032ff;
      user-select: none;
    }
    #card-area {
      min-height: 170px;
      border-radius: 24px;
      box-shadow: 0 5px 20px #ff31697a;
      overflow-wrap: break-word;
      font-weight: 700;
      user-select: none;
      /* animación entrada */
      opacity: 0;
      transform: translateY(48px) scale(0.8) rotate(-6deg);
      animation: cardIn 0.7s forwards cubic-bezier(0.44,1.7,0.58,0.93);
      background: #fff;
      color: #444;
      padding: 20px 20px 30px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      font-size: 1.25rem;
      gap: 8px;
      border: 4px solid transparent;
    }
    @keyframes cardIn {
      0% {
        opacity: 0;
        transform: translateY(48px) scale(0.8) rotate(-6deg);
      }
      70% {
        opacity: 1;
        transform: translateY(-12px) scale(1.05) rotate(4deg);
      }
      100% {
        opacity: 1;
        transform: translateY(0) scale(1) rotate(0);
      }
    }
    .card-type-title {
      font-size: 1.4rem;
      font-weight: 900;
      letter-spacing: 1px;
      width: 100%;
    }
    .card-text {
      font-weight: 700;
    }
    .btn-group {
      width: 100%;
      margin-top: auto;
      display: flex;
      gap: 12px;
      flex-wrap: nowrap;
    }
    .btn-action {
      flex: 1;
      border: none;
      border-radius: 16px;
      padding: 12px;
      font-weight: 700;
      font-size: 1.15rem;
      cursor: pointer;
      user-select: none;
      transition: background-color 0.3s, color 0.3s;
      box-shadow: 0 3px 12px rgb(0 0 0 / 0.09);
    }
    .btn-success {
      background-color: #4bf542;
      color: #1c2f11;
    }
    .btn-success:hover {
      background-color: #10bb10;
      color: white;
    }
    .btn-fail {
      background-color: #ffe600;
      color: #473713;
    }
    .btn-fail:hover {
      background-color: #ffdc00;
      color: #ff0015;
    }
    /* Colores para cada tipo de tarjeta */
    .card-verde {
      border-color: #4bf542;
      background: linear-gradient(130deg, #e1ffe7 70%, #4bf542 100%);
    }
    .card-amarilla {
      border-color: #ffe600;
      background: linear-gradient(130deg, #fffbe1 83%, #fff312 100%);
    }
    .card-roja {
      border-color: #ff3169;
      background: linear-gradient(130deg, #ffe1e1 70%, #ff3169 100%);
    }
    .card-bonus {
      border-color: #a032ff;
      background: linear-gradient(120deg, #f3e1ff 80%, #a032ff 100%);
    }
    /* Control manual de puntos y botones generales */
    .btn-primary, .btn-secondary {
      border: none;
      border-radius: 16px;
      font-weight: 700;
      padding: 14px 0;
      cursor: pointer;
      font-size: 1.15rem;
      user-select: none;
      transition: background-color 0.3s;
      min-width: 100px;
      white-space: nowrap;
    }
    .btn-primary {
      background: #a032ff;
      color: white;
    }
    .btn-primary:hover {
      background: #ff3169;
    }
    .btn-secondary {
      background: #ff3169;
      color: white;
    }
    .btn-secondary:hover {
      background: #a032ff;
    }
    #game-controls {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
      margin-top: 12px;
    }
    /* Panel edición puntos */
    #edit-section, #fin-section {
      display: none;
      flex-direction: column;
      align-items: center;
      background: #fff0ff;
      border-radius: 20px;
      padding: 20px 20px 32px;
      box-shadow: 0 5px 25px rgb(255 49 105 / 0.3);
      user-select: none;
    }
    #edit-section h2, #fin-section h2 {
      color: #a032ff;
      margin-bottom: 16px;
      font-size: 1.5rem;
      font-weight: 800;
      text-align: center;
    }
    #edit-list {
      width: 100%;
      display: flex;
      flex-direction: column;
      gap: 12px;
      max-height: 260px;
      overflow-y: auto;
      padding-right: 6px;
    }
    .edit-player-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
    }
    .edit-player-name {
      font-weight: 700;
      font-size: 1.2rem;
      flex-basis: 40%;
    }
    .edit-points-value {
      flex-basis: 20%;
      font-size: 1.1rem;
      text-align: center;
      font-weight: 700;
      color: #ff3169;
    }
    .edit-btn-group {
      display: flex;
      gap: 8px;
      flex-basis: 40%;
      justify-content: flex-end;
    }
    .edit-btn-small {
      font-size: 1.5rem;
      font-weight: 900;
      width: 38px;
      height: 38px;
      border-radius: 12px;
      border: none;
      cursor: pointer;
      background: #ff3169;
      color: white;
      user-select: none;
      transition: background-color 0.3s;
    }
    .edit-btn-small:hover {
      background: #a032ff;
    }
    .edit-confirm-btn-group {
      margin-top: 18px;
      display: flex;
      gap: 24px;
      justify-content: center;
      width: 100%;
    }
    /* Ranking pantalla final */
    #fin-msg {
      font-weight: 800;
      font-size: 1.8rem;
      color: #ff3169;
      margin-bottom: 18px;
      text-align: center;
    }
    #fin-ranking {
      width: 100%;
      user-select: none;
    }
    #fin-ranking ol {
      padding-left: 1.4em;
      color: #444;
      font-size: 1.2rem;
      line-height: 1.4;
      font-weight: 700;
      margin-bottom: 28px;
    }
    #fin-ranking li {
      margin-bottom: 8px;
    }
  </style>
</head>
<body>
  <main class="container" role="main" aria-label="Juego Amigo de Mierda">
    <h1>Amigo de Mierda 🎉</h1>

    <!-- Panel inicial para agregar jugadores -->
    <section id="setup-section" aria-label="Agregar jugadores">
      <div class="name-input-group">
        <input
          type="text"
          id="name-input"
          placeholder="Nombre del jugador..."
          maxlength="16"
          autocomplete="off"
          aria-label="Nombre del jugador"
        />
        <button id="add-name-btn" aria-label="Agregar jugador" disabled>Agregar</button>
      </div>
      <ul id="player-list" aria-live="polite" aria-relevant="additions removals"></ul>
      <button id="start-btn" disabled aria-label="Iniciar juego">Iniciar Juego</button>
    </section>

    <!-- Panel juego principal -->
    <section id="game-section" aria-label="Juego en progreso" style="display:none;">
      <div class="scoreboard" aria-live="polite" aria-label="Marcador de puntos"></div>
      <div id="turn-indicator" aria-live="assertive" aria-atomic="true"></div>
      <article id="card-area" role="region" aria-live="polite" aria-atomic="true" tabindex="0" ></article>

      <!-- Controles generales del juego -->
      <nav id="game-controls" aria-label="Controles del juego">
        <button class="btn-primary" id="edit-points-btn" type="button">Editar puntos</button>
        <button class="btn-primary" id="reset-btn" type="button">Reiniciar con jugadores</button>
        <button class="btn-primary" id="finish-btn" type="button">Finalizar juego</button>
      </nav>
    </section>

    <!-- Panel edición puntos -->
    <section id="edit-section" aria-label="Edición manual de puntos" style="display:none;">
      <h2>Editar puntos de jugadores</h2>
      <div id="edit-list" tabindex="0"></div>
      <div class="edit-confirm-btn-group">
        <button class="btn-primary" id="confirm-edit-btn" type="button">Guardar cambios</button>
        <button class="btn-primary" id="cancel-edit-btn" type="button">Cancelar</button>
      </div>
    </section>

    <!-- Panel final -->
    <section id="fin-section" aria-label="Resultados del juego" style="display:none;">
      <p id="fin-msg" role="alert" aria-live="assertive"></p>
      <div id="fin-ranking" aria-label="Ranking final"></div>
      <button id="restart-btn" class="btn-secondary" type="button" aria-label="Reiniciar juego">Nueva partida</button>
    </section>
  </main>

  <script>
    // --- Datos constantes con ejemplos y tipos ---
    const challenges = {
      verde: [
        "Sacarte una selfie con alguien que acabás de conocer. ",
        "Decir tres verdades y una mentira (y que adivinen). ",
        "Contar algo que hacías de chico y hoy te da vergüenza. ",
        "Tomar un trago sin usar las manos. ",
        "Decir algo que harías si volvieras a tener 20. ",
        "Inventá un nombre a tu trago. ",
        "“Modo DJ”: elegir el próximo tema, pero si el grupo no lo aprueba, perdés puntos. ",
        "Si fueras un trago, ¿cuál serías y por qué?",
        "Mostrá el sticker que más usas y actualo.",
        "Describir tu peor ruptura usando solo títulos de canciones."
      ],
      amarilla: [
        "Brindar y mirarse fijamente con alguien, hacerlo reír y el que aguanta la risa gana.",
        "Contar una anécdota vergonzosa de tus 20’s.",
        "Mostrá tu foto de DNI.",
        "Adivinar el año de una canción vieja.",
        "Inventá un eslogan para la fiesta.",
        "Decí el abecedario al revés (o morís en el intento 😅).",
        "Hacé una pose de yoga mientras brindás.",
        "Decí tu “crush famoso” sin dudar.",
        "Decí un trabalenguas tres veces rápido.",
        "Memorizá una frase que te digan y repetila al final de la ronda.",
        "Adiviná qué canción tararean.",
        "Tenés que hacer reír a alguien en menos de 20 segundos.",
        "Dejar que otra persona elija el fondo de pantalla de tu celu usalo toda la noche."
      ],
      roja: [
        "Tomar un shot sin hacer mueca (todos votan si lo lograste).",
        "Decir una verdad incómoda o responder una pregunta al estilo “verdad o shot”.",
        "Mostrar una foto vergonzosa de tu galería.",
        "Inventá una coreografía con una persona elegida al azar.",
        "Dejá que otro jugador lea el último mensaje que mandaste (con censura si querés).",
        "Hacé 5 flexiones… pero con tu vaso apoyado en la espalda.",
        "Improvisar un rap sobre los invitados.",
        "Crear un lema para la fiesta y gritarlo como un político en campaña.",
        "Intercambiar una prenda de ropa con alguna persona.",
        "Llamar a un número desconocido y pedir una pizza."
      ],
      bonus: [
        "Elige quien pierde 5 pts.",
        "Elije quienes hacen un brindis todos los 20’s. o +30. y suman 5 pts.",
        "“Desafío doble”: elegís a alguien y los dos hacen un reto juntos (Saca otra tarjeta).",
        "Contar tu recuerdo más gracioso o anécdota con el cumpleañero (aunque lo inventes)."
      ]
    };
    const cardTypes = [
      { key: "verde", title: "🟩 Verde", colorClass: "card-verde", points: 5, prob: 0.4 },
      { key: "amarilla", title: "🟨 Amarilla", colorClass: "card-amarilla", points: 10, prob: 0.3 },
      { key: "roja", title: "🟥 Roja", colorClass: "card-roja", points: 15, prob: 0.22 },
      { key: "bonus", title: "⭐ Bonus", colorClass: "card-bonus", points: 20, prob: 0.08 },
    ];

    // --- Estado y variables --- 
    let players = [];
    let scores = {};
    let turnQueue = [];
    let currentPlayer = "";
    let roundNumber = 1;

    // Elementos DOM usados frecuentemente
    const nameInput = document.getElementById("name-input");
    const addNameBtn = document.getElementById("add-name-btn");
    const playerList = document.getElementById("player-list");
    const startBtn = document.getElementById("start-btn");
    const setupSection = document.getElementById("setup-section");
    const gameSection = document.getElementById("game-section");
    const cardArea = document.getElementById("card-area");
    const turnIndicator = document.getElementById("turn-indicator");
    const scoreboard = document.querySelector(".scoreboard");
    const editSection = document.getElementById("edit-section");
    const editList = document.getElementById("edit-list");
    const finSection = document.getElementById("fin-section");
    const finMsg = document.getElementById("fin-msg");
    const finRanking = document.getElementById("fin-ranking");

    // Botones controles
    const editPointsBtn = document.getElementById("edit-points-btn");
    const resetBtn = document.getElementById("reset-btn");
    const finishBtn = document.getElementById("finish-btn");
    const confirmEditBtn = document.getElementById("confirm-edit-btn");
    const cancelEditBtn = document.getElementById("cancel-edit-btn");
    const restartBtn = document.getElementById("restart-btn");

    // --- Funciones UI y lógica ---

    // Activar botón agregar solo si hay texto válido
    nameInput.addEventListener("input", () => {
      addNameBtn.disabled = nameInput.value.trim() === "";
    });

    // Agregar jugador
    addNameBtn.addEventListener("click", () => {
      let name = nameInput.value.trim().substring(0, 16);
      if (name !== "" && !players.includes(name)) {
        players.push(name);
        scores[name] = 0;
        nameInput.value = "";
        addNameBtn.disabled = true;
        renderPlayerList();
        toggleStartButton();
      }
      nameInput.focus();
    });
    // Permitir enter para agregar
    nameInput.addEventListener("keyup", (e) => {
      if (e.key === "Enter" && !addNameBtn.disabled) addNameBtn.click();
    });

    // Mostrar lista de jugadores en setup
    function renderPlayerList() {
      playerList.innerHTML = "";
      players.forEach((p, idx) => {
        const li = document.createElement("li");
        li.textContent = p;
        // Botón eliminar jugador
        const rmBtn = document.createElement("button");
        rmBtn.className = "remove-player";
        rmBtn.setAttribute("aria-label", `Eliminar jugador ${p}`);
        rmBtn.textContent = "×";
        rmBtn.onclick = () => {
          players.splice(idx, 1);
          delete scores[p];
          renderPlayerList();
          toggleStartButton();
        };
        li.appendChild(rmBtn);
        playerList.appendChild(li);
      });
    }

    // Mostrar y habilitar botón Iniciar
    function toggleStartButton() {
      startBtn.disabled = players.length < 2;
    }

    // Empieza la partida: ocultar setup, mostrar juego, inicializar cola y scores
    startBtn.addEventListener("click", () => {
      if (players.length < 2) return;
      roundNumber = 1;
      resetScores();
      shuffleTurnQueue();
      setupSection.style.display = "none";
      gameSection.style.display = "flex";
      finSection.style.display = "none";
      displayScoreboard();
      displayCurrentTurn();
      showNextCard();
    });

    // Resetea puntajes a 0
    function resetScores() {
      players.forEach(p => {
        scores[p] = 0;
      });
    }

    // Baraja el array jugadores para la ronda actual
    function shuffleTurnQueue() {
      turnQueue = [...players];
      for (let i = turnQueue.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [turnQueue[i], turnQueue[j]] = [turnQueue[j], turnQueue[i]];
      }
    }

    // Actualiza el marcador con el estado actual y resalta jugador activo
    function displayScoreboard() {
      scoreboard.innerHTML = "";
      players.forEach(player => {
        const div = document.createElement("div");
        div.className = "score-player";
        if (player === currentPlayer) div.classList.add("current");
        div.setAttribute("aria-label", `${player}, puntos: ${scores[player]}`);
        div.innerHTML = `<span>${player}</span><span class="points">${scores[player]}</span>`;
        scoreboard.appendChild(div);
      });
    }

    // Actualiza indicador con el jugador actual y ronda
    function displayCurrentTurn() {
      turnIndicator.textContent = `Turno de: ${currentPlayer} | Ronda ${roundNumber}`;
    }

    // Escoger tipo de carta basado en probabilidad
    function pickRandomCardType() {
      let rnd = Math.random();
      let accum = 0;
      for (const card of cardTypes) {
        accum += card.prob;
        if (rnd < accum) return card;
      }
      return cardTypes[0]; // fallback
    }

    // Muestra tarjeta y crea botones de interacción
    function showNextCard() {
      if (turnQueue.length === 0) {
        roundNumber++;
        shuffleTurnQueue();
      }
      currentPlayer = turnQueue.shift();
      displayScoreboard();
      displayCurrentTurn();

      const card = pickRandomCardType();
      const textArr = challenges[card.key];
      const challengeText = textArr[Math.floor(Math.random() * textArr.length)];

      cardArea.className = `card-area ${card.colorClass}`;
      cardArea.style.animation = "none"; // reiniciar animación
      cardArea.offsetHeight; // fuerza reflow
      cardArea.style.animation = null;

      cardArea.innerHTML = `
        <div class="card-type-title">${card.title} (${card.points} pts)</div>
        <div class="card-text">${challengeText}</div>
        <div class="btn-group" role="group" aria-label="Acciones para ${currentPlayer}">
          <button class="btn-action btn-success" id="btn-fulfilled" aria-label="Cumplió el reto, sumar puntos">✅ Cumplió</button>
          <button class="btn-action btn-fail" id="btn-notfulfilled" aria-label="No cumplió el reto, no sumar puntos">❌ No cumplió</button>
        </div>
      `;

      document.getElementById("btn-fulfilled").onclick = () => {
        scores[currentPlayer] += card.points;
        advanceTurn();
      };
      document.getElementById("btn-notfulfilled").onclick = () => {
        advanceTurn();
      };
    }

    // Avanza la ronda y muestra la siguiente tarjeta o fin si se desea
    function advanceTurn() {
      if (players.length === 0) return;
      if (turnQueue.length === 0) {
        // Terminó ronda, barajar para la próxima
        roundNumber++;
        shuffleTurnQueue();
      }
      showNextCard();
    }

    // Botón editar puntos abrir panel modal editSection
    editPointsBtn.addEventListener("click", () => {
      populateEditList();
      editSection.style.display = "flex";
      gameSection.style.display = "none";
      finSection.style.display = "none";
    });

    // Población lista de edición de puntos con controles +/-
    function populateEditList() {
      editList.innerHTML = "";
      players.forEach(p => {
        const div = document.createElement("div");
        div.className = "edit-player-row";

        const nameSpan = document.createElement("span");
        nameSpan.textContent = p;
        nameSpan.className = "edit-player-name";

        const pointsSpan = document.createElement("span");
        pointsSpan.textContent = scores[p];
        pointsSpan.className = "edit-points-value";
        pointsSpan.id = `edit-points-${p}`;

        const btnGroup = document.createElement("div");
        btnGroup.className = "edit-btn-group";

        const decBtn = document.createElement("button");
        decBtn.className = "edit-btn-small";
        decBtn.setAttribute("aria-label", `Restar punto a ${p}`);
        decBtn.textContent = "−";
        decBtn.onclick = () => {
          if (scores[p] > 0) {
            scores[p]--;
            pointsSpan.textContent = scores[p];
            displayScoreboard();
          }
        };

        const incBtn = document.createElement("button");
        incBtn.className = "edit-btn-small";
        incBtn.setAttribute("aria-label", `Sumar punto a ${p}`);
        incBtn.textContent = "+";
        incBtn.onclick = () => {
          scores[p]++;
          pointsSpan.textContent = scores[p];
          displayScoreboard();
        };

        btnGroup.appendChild(decBtn);
        btnGroup.appendChild(incBtn);

        div.appendChild(nameSpan);
        div.appendChild(pointsSpan);
        div.appendChild(btnGroup);

        editList.appendChild(div);
      });
    }

    // Guardar cambios (ya esta actualizado en scores) y regresar al juego
    confirmEditBtn.addEventListener("click", () => {
      editSection.style.display = "none";
      gameSection.style.display = "flex";
      displayScoreboard();
      displayCurrentTurn();
    });
    cancelEditBtn.addEventListener("click", () => {
      editSection.style.display = "none";
      gameSection.style.display = "flex";
    });

    // Reiniciar juego con mismos jugadores, reset puntos y mezcla turnos
    resetBtn.addEventListener("click", () => {
      roundNumber = 1;
      resetScores();
      shuffleTurnQueue();
      displayScoreboard();
      displayCurrentTurn();
      showNextCard();
      setupSection.style.display = "none";
      finSection.style.display = "none";
      gameSection.style.display = "flex";
      editSection.style.display = "none";
      nameInput.focus();
    });

    // Finalizar juego: mostrar ranking y ganador
    finishBtn.addEventListener("click", () => {
      gameSection.style.display = "none";
      editSection.style.display = "none";
      finSection.style.display = "flex";
      showFinalResults();
    });

    // Mostrar resultados finales ordenados
    function showFinalResults() {
      const ranking = [...players]
        .map(p => ({ name: p, points: scores[p] }))
        .sort((a, b) => b.points - a.points);

      const maxPoints = ranking[0]?.points || 0;
      const winners = ranking.filter(p => p.points === maxPoints).map(p => p.name);

      finMsg.textContent =
        winners.length === 1
          ? `¡Ganador/a: ${winners[0]} con ${maxPoints} puntos! 🏆`
          : `¡Empate entre: ${winners.join(", ")} (${maxPoints} pts)! 🎉`;

      let ol = "<ol>";
      ranking.forEach(p => {
        ol += `<li>${p.name} — <b>${p.points}</b> pts</li>`;
      });
      ol += "</ol>";
      finRanking.innerHTML = ol;
    }

    // Reiniciar juego completamente (limpia todo y vuelve a setup)
    restartBtn.addEventListener("click", () => {
      players = [];
      scores = {};
      turnQueue = [];
      currentPlayer = "";
      roundNumber = 1;
      playerList.innerHTML = "";
      nameInput.value = "";
      addNameBtn.disabled = true;
      toggleStartButton();
      finSection.style.display = "none";
      setupSection.style.display = "flex";
      gameSection.style.display = "none";
      editSection.style.display = "none";
      nameInput.focus();
    });

    // Inicialización: enfocar input y deshabilitar botones innecesarios
    window.onload = () => {
      nameInput.focus();
      addNameBtn.disabled = true;
      startBtn.disabled = true;
    };
  </script>
</body>
</html>
